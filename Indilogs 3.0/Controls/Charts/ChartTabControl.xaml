<UserControl x:Class="IndiLogs_3._0.Controls.Charts.ChartTabControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:charts="clr-namespace:IndiLogs_3._0.Controls.Charts"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="1000"
             Background="{DynamicResource BgDark}">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>      <!-- Toolbar -->
            <RowDefinition Height="50"/>        <!-- State Timeline -->
            <RowDefinition Height="Auto"/>      <!-- Navigation Slider -->
            <RowDefinition Height="*"/>         <!-- Charts Area -->
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="220"/>     <!-- Signal List -->
            <ColumnDefinition Width="Auto"/>    <!-- Splitter -->
            <ColumnDefinition Width="*"/>       <!-- Charts -->
        </Grid.ColumnDefinitions>

        <!-- Toolbar - spans all columns -->
        <charts:ChartToolbar x:Name="Toolbar" Grid.Row="0" Grid.ColumnSpan="3"/>

        <!-- State Timeline - spans all columns -->
        <charts:ChartStateTimeline x:Name="StateTimeline" Grid.Row="1" Grid.ColumnSpan="3" Margin="0,2"/>

        <!-- Navigation Slider - spans all columns -->
        <Border Grid.Row="2" Grid.ColumnSpan="3" Background="{DynamicResource BgPanel}"
                BorderBrush="{DynamicResource BorderColor}" BorderThickness="0,1" Padding="10,5">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Button x:Name="NavLeftButton" Content="◀" Grid.Column="0" Width="30"
                        Style="{DynamicResource ModernBtn}" Click="NavLeftButton_Click"
                        ToolTip="Move view left"/>

                <Slider x:Name="NavSlider" Grid.Column="1" Margin="10,0"
                        Minimum="0" Maximum="100" Value="0"
                        ValueChanged="NavSlider_ValueChanged"
                        VerticalAlignment="Center"/>

                <Button x:Name="NavRightButton" Content="▶" Grid.Column="2" Width="30"
                        Style="{DynamicResource ModernBtn}" Click="NavRightButton_Click"
                        ToolTip="Move view right"/>
            </Grid>
        </Border>

        <!-- Signal List - Left panel -->
        <charts:ChartSignalList x:Name="SignalList" Grid.Row="3" Grid.Column="0"/>

        <!-- Splitter -->
        <GridSplitter Grid.Row="3" Grid.Column="1" Width="5"
                      HorizontalAlignment="Center" VerticalAlignment="Stretch"
                      Background="{DynamicResource BorderColor}" Cursor="SizeWE"/>

        <!-- Charts ScrollViewer -->
        <ScrollViewer Grid.Row="3" Grid.Column="2"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled"
                      Background="{DynamicResource BgDark}">
            <ItemsControl x:Name="ChartsContainer">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Vertical"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Background="{DynamicResource BgPanel}"
                                BorderBrush="{DynamicResource BorderColor}"
                                BorderThickness="1" CornerRadius="6" Margin="5"
                                Padding="0">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>  <!-- Header -->
                                    <RowDefinition Height="*"/>     <!-- Chart -->
                                    <RowDefinition Height="Auto"/>  <!-- Resize gripper -->
                                </Grid.RowDefinitions>

                                <!-- Chart Header -->
                                <Border Grid.Row="0" Background="{DynamicResource BgCard}"
                                        CornerRadius="6,6,0,0" Padding="10,5">
                                    <Grid>
                                        <TextBlock Text="{Binding Title}"
                                                   Foreground="{DynamicResource TextPrimary}"
                                                   FontWeight="SemiBold" FontSize="12"
                                                   VerticalAlignment="Center"/>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                            <Button Content="✕" Width="24" Height="24"
                                                    Style="{DynamicResource ModernBtn}"
                                                    Tag="{Binding}"
                                                    Click="RemoveChartButton_Click"
                                                    ToolTip="Remove this chart"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>

                                <!-- Chart View -->
                                <charts:ChartGraphView x:Name="GraphView" Grid.Row="1"
                                                       Height="{Binding ChartHeight}"
                                                       Tag="{Binding}"/>

                                <!-- Resize Gripper -->
                                <Thumb Grid.Row="2" Height="8" Cursor="SizeNS"
                                       DragDelta="ChartResizeThumb_DragDelta"
                                       Tag="{Binding}">
                                    <Thumb.Template>
                                        <ControlTemplate>
                                            <Border Background="{DynamicResource BgCard}"
                                                    CornerRadius="0,0,6,6">
                                                <Rectangle Width="40" Height="4"
                                                           Fill="{DynamicResource BorderColor}"
                                                           RadiusX="2" RadiusY="2"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Thumb.Template>
                                </Thumb>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Empty State Message -->
        <TextBlock x:Name="EmptyStateMessage" Grid.Row="3" Grid.Column="2"
                   Text="No CSV loaded. Click 'Load CSV' to open a data file, or double-click signals to add charts."
                   Foreground="{DynamicResource TextSecondary}"
                   HorizontalAlignment="Center" VerticalAlignment="Center"
                   FontSize="14" TextWrapping="Wrap" Margin="40"
                   Visibility="Visible"/>
    </Grid>
</UserControl>

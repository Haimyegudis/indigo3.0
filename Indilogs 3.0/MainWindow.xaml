<Window x:Class="IndiLogs_3._0.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:IndiLogs_3._0.ViewModels"
        xmlns:controls="clr-namespace:IndiLogs_3._0.Controls"
        xmlns:views="clr-namespace:IndiLogs_3._0.Views"
        xmlns:converters="clr-namespace:IndiLogs_3._0.Converters"
        mc:Ignorable="d"
        Title="{Binding WindowTitle}"
        Height="700" Width="1100"
        Background="{DynamicResource BgDark}"
        WindowStartupLocation="CenterScreen"
        AllowDrop="True"
        Drop="Window_Drop"
        TextOptions.TextFormattingMode="Display"
        UseLayoutRounding="True">

    <Window.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter"/>
        <converters:BoolToArrowConverter x:Key="BoolToArrowConverter"/>
        <converters:BoolToArrowConverter x:Key="BoolToArrowConverterRight" TrueValue="▶" FalseValue="◀"/>
    </Window.Resources>

    <Window.DataContext>
        <vm:MainViewModel />
    </Window.DataContext>

    <Window.InputBindings>
        <KeyBinding Key="S" Modifiers="Ctrl" Command="{Binding OpenSnakeGameCommand}" />
        <KeyBinding Key="I" Modifiers="Ctrl" Command="{Binding OpenIndigoInvadersCommand}" />
        <KeyBinding Key="Space" Command="{Binding MarkRowCommand}" />
        <KeyBinding Key="Z" Modifiers="Ctrl" Command="{Binding UndoFilterOutCommand}" />
        <KeyBinding Key="OemPlus" Modifiers="Ctrl" Command="{Binding ZoomInCommand}" />
        <KeyBinding Key="Add" Modifiers="Ctrl" Command="{Binding ZoomInCommand}" />
        <KeyBinding Key="OemMinus" Modifiers="Ctrl" Command="{Binding ZoomOutCommand}" />
        <KeyBinding Key="Subtract" Modifiers="Ctrl" Command="{Binding ZoomOutCommand}" />
        <KeyBinding Key="F" Modifiers="Ctrl" Command="{Binding ToggleSearchCommand}" />
        <KeyBinding Key="Esc" Command="{Binding CloseSearchCommand}" />
    </Window.InputBindings>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="50"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="24"/>
        </Grid.RowDefinitions>

        <controls:HeaderControl Grid.Row="0" DataContext="{Binding}"/>

        <Grid Grid.Row="1" x:Name="MainContentGrid">
            <Grid.ColumnDefinitions>
                <!-- Left panel - Column 0 -->
                <ColumnDefinition x:Name="LeftPanelColumn" Width="200"/>
                <!-- GridSplitter column - Column 1 -->
                <ColumnDefinition x:Name="LeftSplitterColumn" Width="Auto"/>
                <!-- Main content - Column 2 -->
                <ColumnDefinition Width="*"/>
                <!-- Right splitter - Column 3 -->
                <ColumnDefinition x:Name="RightSplitterColumn" Width="Auto"/>
                <!-- Right panel - Column 4 -->
                <ColumnDefinition x:Name="RightPanelColumn" Width="200"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel with hover toggle button -->
            <Grid Grid.Column="0" Visibility="{Binding IsLeftPanelVisible, Converter={StaticResource BoolToVisibilityConverter}}">
                <Grid Background="{DynamicResource BgPanel}">
                <TabControl x:Name="LeftPanelTabs" Background="Transparent" BorderThickness="0" Margin="0" Padding="0" SelectedIndex="{Binding LeftTabIndex}" Width="200">
                    <TabItem Header="EXPLORER">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <TextBlock Grid.Row="0" Text="OPEN SESSIONS" Foreground="{DynamicResource TextSecondary}" FontWeight="Bold" FontSize="11" Margin="15,15,0,10"/>
                            <ListBox Grid.Row="1" ItemsSource="{Binding LoadedSessions}" SelectedItem="{Binding SelectedSession, Mode=TwoWay}" Background="Transparent" BorderThickness="0" Foreground="{DynamicResource TextPrimary}" ScrollViewer.HorizontalScrollBarVisibility="Disabled" Margin="5,0">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="0,6">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="📄" Margin="0,0,10,0" Foreground="{DynamicResource TextSecondary}" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="1" Text="{Binding FileName}" ToolTip="{Binding FilePath}" TextWrapping="Wrap" VerticalAlignment="Center"/>
                                        </Grid>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                                <ListBox.ItemContainerStyle>
                                    <Style TargetType="ListBoxItem">
                                        <Setter Property="Padding" Value="10,6"/>
                                        <Setter Property="Cursor" Value="Hand"/>
                                        <Setter Property="Foreground" Value="{DynamicResource TextPrimary}"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="ListBoxItem">
                                                    <Border Name="Border" Background="Transparent" CornerRadius="6" Padding="{TemplateBinding Padding}">
                                                        <ContentPresenter/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="Border" Property="Background" Value="#15888888"/>
                                                        </Trigger>
                                                        <Trigger Property="IsSelected" Value="True">
                                                            <Setter TargetName="Border" Property="Background" Value="{DynamicResource PrimaryColor}"/>
                                                            <Setter Property="Foreground" Value="White"/>
                                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </ListBox.ItemContainerStyle>
                            </ListBox>

                            <Grid Grid.Row="2" VerticalAlignment="Bottom" Margin="10,0,10,10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Border Grid.Row="0" Background="{DynamicResource BgCard}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" CornerRadius="8" Padding="10" Margin="0,0,0,10" Visibility="{Binding IsExplorerMenuOpen, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <Border.Effect>
                                        <DropShadowEffect Color="Black" Opacity="0.2" BlurRadius="10" ShadowDepth="2"/>
                                    </Border.Effect>
                                    <StackPanel>
                                        <DockPanel LastChildFill="False" Margin="0,0,0,8">
                                            <TextBlock Text="Actions" FontWeight="Bold" Foreground="{DynamicResource TextSecondary}" VerticalAlignment="Center" FontSize="11"/>
                                        </DockPanel>
                                        <Button Command="{Binding ClearCommand}" Background="{DynamicResource DangerColor}" Style="{DynamicResource PrimaryBtn}" Margin="0,0,0,8">
                                            <Viewbox Stretch="Uniform" StretchDirection="DownOnly">
                                                <TextBlock Text="🗑 Clear All"/>
                                            </Viewbox>
                                        </Button>
                                        <Button Command="{Binding OpenMarkedLogsWindowCommand}" Style="{DynamicResource ModernBtn}" Background="{DynamicResource BgPanel}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,5">
                                            <Viewbox Stretch="Uniform" StretchDirection="DownOnly">
                                                <TextBlock Text="📌 Marked Lines"/>
                                            </Viewbox>
                                        </Button>
                                        <Button Command="{Binding OpenGlobalGrepCommand}" Style="{DynamicResource ModernBtn}" Background="{DynamicResource BgPanel}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,5">
                                            <Viewbox Stretch="Uniform" StretchDirection="DownOnly">
                                                <TextBlock Text="🔍 Global Grep"/>
                                            </Viewbox>
                                        </Button>
                                        <Button Command="{Binding OpenStatesWindowCommand}" Style="{DynamicResource ModernBtn}" Background="{DynamicResource BgPanel}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,5" Visibility="{Binding IsPLCTabSelected, Converter={StaticResource BoolToVisibilityConverter}}">
                                            <Viewbox Stretch="Uniform" StretchDirection="DownOnly">
                                                <TextBlock Text="🔄 States"/>
                                            </Viewbox>
                                        </Button>
                                        <Button Command="{Binding ExportParsedDataCommand}" Style="{DynamicResource ModernBtn}" Background="{DynamicResource BgPanel}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,5" Visibility="{Binding IsPLCTabSelected, Converter={StaticResource BoolToVisibilityConverter}}">
                                            <Viewbox Stretch="Uniform" StretchDirection="DownOnly">
                                                <TextBlock Text="📊 Export CSV"/>
                                            </Viewbox>
                                        </Button>
                                        <Button Command="{Binding RunAnalysisCommand}" Style="{DynamicResource ModernBtn}" Background="{DynamicResource BgPanel}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,5">
                                            <Viewbox Stretch="Uniform" StretchDirection="DownOnly">
                                                <TextBlock Text="⚙ Reports"/>
                                            </Viewbox>
                                        </Button>
                                        <Button Command="{Binding OpenStripeAnalysisCommand}" Style="{DynamicResource ModernBtn}" Background="{DynamicResource BgPanel}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,5" Visibility="{Binding IsAppTabSelected, Converter={StaticResource BoolToVisibilityConverter}}">
                                            <Viewbox Stretch="Uniform" StretchDirection="DownOnly">
                                                <TextBlock Text="🖨 Stripe Analysis"/>
                                            </Viewbox>
                                        </Button>
                                        <Separator Margin="0,10,0,10" Background="{DynamicResource BorderColor}"/>
                                        <DockPanel LastChildFill="False" Margin="0,0,0,8">
                                            <TextBlock Text="Case File" FontWeight="Bold" Foreground="{DynamicResource TextSecondary}" VerticalAlignment="Center" FontSize="11"/>
                                        </DockPanel>
                                        <Button Command="{Binding SaveCaseCommand}" Style="{DynamicResource ModernBtn}" Background="{DynamicResource BgPanel}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,5">
                                            <Viewbox Stretch="Uniform" StretchDirection="DownOnly">
                                                <TextBlock Text="💾 Save Case"/>
                                            </Viewbox>
                                        </Button>
                                        <Button Command="{Binding LoadCaseCommand}" Style="{DynamicResource ModernBtn}" Background="{DynamicResource BgPanel}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" Foreground="{DynamicResource TextPrimary}">
                                            <Viewbox Stretch="Uniform" StretchDirection="DownOnly">
                                                <TextBlock Text="📂 Load Case"/>
                                            </Viewbox>
                                        </Button>
                                    </StackPanel>
                                </Border>
                                <Button Grid.Row="1" Command="{Binding ToggleExplorerMenuCommand}" Background="{DynamicResource BgCard}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" HorizontalAlignment="Left" Width="40" Height="40" ToolTip="Show Actions">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="border" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="20">
                                                <Border.Effect>
                                                    <DropShadowEffect Color="Black" Opacity="0.15" BlurRadius="5" ShadowDepth="2"/>
                                                </Border.Effect>
                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="border" Property="Background" Value="{DynamicResource BgCardHover}"/>
                                                    <Setter TargetName="border" Property="BorderBrush" Value="{DynamicResource PrimaryColor}"/>
                                                </Trigger>
                                                <Trigger Property="IsPressed" Value="True">
                                                    <Setter TargetName="border" Property="Background" Value="{DynamicResource PrimaryColor}"/>
                                                    <Setter Property="Foreground" Value="White"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                    <Grid>
                                        <TextBlock Text="••" FontSize="20" FontWeight="Bold" Foreground="{DynamicResource TextPrimary}" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,-8,0,0">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsExplorerMenuOpen}" Value="True">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                        <TextBlock Text="✕" FontSize="14" FontWeight="Bold" Foreground="{DynamicResource TextPrimary}" HorizontalAlignment="Center" VerticalAlignment="Center">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsExplorerMenuOpen}" Value="True">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </Grid>
                                </Button>
                            </Grid>
                        </Grid>
                    </TabItem>

                    <TabItem Header="LOGGERS">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <TextBlock Grid.Row="0" Text="APP LOGGERS" Foreground="{DynamicResource TextSecondary}" FontWeight="Bold" FontSize="11" Margin="15,15,0,10"/>
                            <TreeView Grid.Row="1" ItemsSource="{Binding LoggerTreeRoot}" Background="Transparent" BorderThickness="0" Foreground="{DynamicResource TextPrimary}" Margin="5,0">
                                <TreeView.ItemContainerStyle>
                                    <Style TargetType="TreeViewItem">
                                        <Setter Property="IsExpanded" Value="False"/>
                                        <Setter Property="Foreground" Value="{DynamicResource TextPrimary}"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsHidden}" Value="True">
                                                <Setter Property="Foreground" Value="{DynamicResource TextSecondary}"/>
                                                <Setter Property="FontStyle" Value="Italic"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TreeView.ItemContainerStyle>
                                <TreeView.ItemTemplate>
                                    <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                                        <Grid Margin="0,2">
                                            <Grid.ContextMenu>
                                                <ContextMenu>
                                                    <MenuItem Header="Show This" Command="{Binding DataContext.TreeShowThisCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding}"/>
                                                    <MenuItem Header="Hide This" Command="{Binding DataContext.TreeHideThisCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding}"/>
                                                    <MenuItem Header="Show Only This" Command="{Binding DataContext.TreeShowOnlyThisCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding}"/>
                                                    <MenuItem Header="Show With Children" Command="{Binding DataContext.TreeShowWithChildrenCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding}"/>
                                                    <MenuItem Header="Hide With Children" Command="{Binding DataContext.TreeHideWithChildrenCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding}"/>
                                                    <Separator/>
                                                    <MenuItem Header="Show All" Command="{Binding DataContext.TreeShowAllCommand, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                                </ContextMenu>
                                            </Grid.ContextMenu>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding Name}" ToolTip="{Binding FullPath}" VerticalAlignment="Center"/>
                                                <TextBlock Text="{Binding Count, StringFormat=' ({0})'}" Foreground="{DynamicResource TextSecondary}" Margin="5,0,0,0" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </Grid>
                                    </HierarchicalDataTemplate>
                                </TreeView.ItemTemplate>
                            </TreeView>

                            <Grid Grid.Row="2" VerticalAlignment="Bottom" Margin="10,0,10,10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Border Grid.Row="0" Background="{DynamicResource BgCard}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" CornerRadius="8" Padding="10" Margin="0,0,0,10" Visibility="{Binding IsExplorerMenuOpen, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <Border.Effect>
                                        <DropShadowEffect Color="Black" Opacity="0.2" BlurRadius="10" ShadowDepth="2"/>
                                    </Border.Effect>
                                    <StackPanel>
                                        <DockPanel LastChildFill="False" Margin="0,0,0,8">
                                            <TextBlock Text="Actions" FontWeight="Bold" Foreground="{DynamicResource TextSecondary}" VerticalAlignment="Center" FontSize="11"/>
                                        </DockPanel>
                                        <Button Command="{Binding ClearCommand}" Background="{DynamicResource DangerColor}" Style="{DynamicResource PrimaryBtn}" Margin="0,0,0,8">
                                            <Viewbox Stretch="Uniform" StretchDirection="DownOnly">
                                                <TextBlock Text="🗑 Clear All"/>
                                            </Viewbox>
                                        </Button>
                                        <Button Command="{Binding OpenMarkedLogsWindowCommand}" Style="{DynamicResource ModernBtn}" Background="{DynamicResource BgPanel}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,5">
                                            <Viewbox Stretch="Uniform" StretchDirection="DownOnly">
                                                <TextBlock Text="📌 Marked Lines"/>
                                            </Viewbox>
                                        </Button>
                                        <Button Command="{Binding OpenGlobalGrepCommand}" Style="{DynamicResource ModernBtn}" Background="{DynamicResource BgPanel}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,5">
                                            <Viewbox Stretch="Uniform" StretchDirection="DownOnly">
                                                <TextBlock Text="🔍 Global Grep"/>
                                            </Viewbox>
                                        </Button>
                                        <Button Command="{Binding OpenStatesWindowCommand}" Style="{DynamicResource ModernBtn}" Background="{DynamicResource BgPanel}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,5" Visibility="{Binding IsPLCTabSelected, Converter={StaticResource BoolToVisibilityConverter}}">
                                            <Viewbox Stretch="Uniform" StretchDirection="DownOnly">
                                                <TextBlock Text="🔄 States"/>
                                            </Viewbox>
                                        </Button>
                                        <Button Command="{Binding ExportParsedDataCommand}" Style="{DynamicResource ModernBtn}" Background="{DynamicResource BgPanel}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,5" Visibility="{Binding IsPLCTabSelected, Converter={StaticResource BoolToVisibilityConverter}}">
                                            <Viewbox Stretch="Uniform" StretchDirection="DownOnly">
                                                <TextBlock Text="📊 Export CSV"/>
                                            </Viewbox>
                                        </Button>
                                        <Button Command="{Binding RunAnalysisCommand}" Style="{DynamicResource ModernBtn}" Background="{DynamicResource BgPanel}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,5">
                                            <Viewbox Stretch="Uniform" StretchDirection="DownOnly">
                                                <TextBlock Text="⚙ Reports"/>
                                            </Viewbox>
                                        </Button>
                                        <Button Command="{Binding OpenStripeAnalysisCommand}" Style="{DynamicResource ModernBtn}" Background="{DynamicResource BgPanel}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,5" Visibility="{Binding IsAppTabSelected, Converter={StaticResource BoolToVisibilityConverter}}">
                                            <Viewbox Stretch="Uniform" StretchDirection="DownOnly">
                                                <TextBlock Text="🖨 Stripe Analysis"/>
                                            </Viewbox>
                                        </Button>
                                        <Separator Margin="0,10,0,10" Background="{DynamicResource BorderColor}"/>
                                        <DockPanel LastChildFill="False" Margin="0,0,0,8">
                                            <TextBlock Text="Case File" FontWeight="Bold" Foreground="{DynamicResource TextSecondary}" VerticalAlignment="Center" FontSize="11"/>
                                        </DockPanel>
                                        <Button Command="{Binding SaveCaseCommand}" Style="{DynamicResource ModernBtn}" Background="{DynamicResource BgPanel}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,5">
                                            <Viewbox Stretch="Uniform" StretchDirection="DownOnly">
                                                <TextBlock Text="💾 Save Case"/>
                                            </Viewbox>
                                        </Button>
                                        <Button Command="{Binding LoadCaseCommand}" Style="{DynamicResource ModernBtn}" Background="{DynamicResource BgPanel}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" Foreground="{DynamicResource TextPrimary}">
                                            <Viewbox Stretch="Uniform" StretchDirection="DownOnly">
                                                <TextBlock Text="📂 Load Case"/>
                                            </Viewbox>
                                        </Button>
                                    </StackPanel>
                                </Border>
                                <Button Grid.Row="1" Command="{Binding ToggleExplorerMenuCommand}" Background="{DynamicResource BgCard}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" HorizontalAlignment="Left" Width="40" Height="40" ToolTip="Show Actions">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="border" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="20">
                                                <Border.Effect>
                                                    <DropShadowEffect Color="Black" Opacity="0.15" BlurRadius="5" ShadowDepth="2"/>
                                                </Border.Effect>
                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="border" Property="Background" Value="{DynamicResource BgCardHover}"/>
                                                    <Setter TargetName="border" Property="BorderBrush" Value="{DynamicResource PrimaryColor}"/>
                                                </Trigger>
                                                <Trigger Property="IsPressed" Value="True">
                                                    <Setter TargetName="border" Property="Background" Value="{DynamicResource PrimaryColor}"/>
                                                    <Setter Property="Foreground" Value="White"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                    <Grid>
                                        <TextBlock Text="••" FontSize="20" FontWeight="Bold" Foreground="{DynamicResource TextPrimary}" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,-8,0,0">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsExplorerMenuOpen}" Value="True">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                        <TextBlock Text="✕" FontSize="14" FontWeight="Bold" Foreground="{DynamicResource TextPrimary}" HorizontalAlignment="Center" VerticalAlignment="Center">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsExplorerMenuOpen}" Value="True">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </Grid>
                                </Button>
                            </Grid>
                        </Grid>
                    </TabItem>
                </TabControl>
                </Grid>
                <!-- Left panel hide button (appears on hover at right edge) -->
                <Border x:Name="LeftPanelHideButton" Width="16" HorizontalAlignment="Right" VerticalAlignment="Stretch"
                        Background="Transparent" Cursor="Hand" Opacity="0.3"
                        MouseLeftButtonDown="LeftPanelHideButton_Click">
                    <Border.Style>
                        <Style TargetType="Border">
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource BgCardHover}"/>
                                    <Setter Property="Opacity" Value="1"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>
                    <TextBlock Text="◀" FontSize="10" FontWeight="Bold" VerticalAlignment="Center" HorizontalAlignment="Center"
                               Foreground="{DynamicResource TextSecondary}"/>
                </Border>
            </Grid>

            <GridSplitter Grid.Column="1" Width="4" HorizontalAlignment="Center" VerticalAlignment="Stretch" Background="Transparent" ShowsPreview="True"
                          Visibility="{Binding IsLeftPanelVisible, Converter={StaticResource BoolToVisibilityConverter}}"/>

            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="5"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <controls:SearchPanelControl Grid.Row="0" DataContext="{Binding}"
                              Visibility="{Binding IsSearchPanelVisible, Converter={StaticResource BoolToVisibilityConverter}}"/>
                <TabControl x:Name="MainTabs" Grid.Row="1" SelectedIndex="{Binding SelectedTabIndex}" BorderThickness="0" Background="Transparent" Padding="0" SelectionChanged="TabControl_SelectionChanged">

                    <TabItem Header="PLC LOGS">
                        <controls:PlcLogsTabControl x:Name="PlcLogsTab" DataContext="{Binding}" Loaded="PlcLogsTab_Loaded"/>
                    </TabItem>

                    <TabItem Header="PLC (FILTERED)">
                        <controls:PlcFilteredTabControl x:Name="PlcFilteredTab" DataContext="{Binding}"/>
                    </TabItem>

                    <TabItem Header="APP">
                        <controls:AppLogsTabControl x:Name="AppLogsTab" DataContext="{Binding}"/>
                    </TabItem>

                    <TabItem Header="EVENTS">
                        <DataGrid ItemsSource="{Binding Events}" FontSize="{Binding GridFontSize}" FontFamily="{DynamicResource ContentFontFamily}" FontWeight="{DynamicResource ContentFontWeight}" AutoGenerateColumns="False" IsReadOnly="True" RowStyle="{DynamicResource LogRowStyle}" CanUserAddRows="False" VerticalScrollBarVisibility="Auto">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Time" Binding="{Binding Time, StringFormat='yyyy-MM-dd HH:mm:ss.fff'}" Width="180"/>
                                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="200" FontWeight="Bold"/>
                                <DataGridTextColumn Header="State" Binding="{Binding State}" Width="120" Foreground="{DynamicResource PrimaryColor}"/>
                                <DataGridTextColumn Header="Severity" Binding="{Binding Severity}" Width="80"/>
                                <DataGridTextColumn Header="Parameters" Binding="{Binding Parameters}" Width="200">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                            <Setter Property="ToolTip" Value="{Binding Parameters}"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Info" Binding="{Binding Description}" Width="*"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </TabItem>

                    <TabItem Header="SCREENSHOTS">
                        <Grid Background="{DynamicResource BgDark}" ClipToBounds="True">
                            <ScrollViewer x:Name="ScreenshotScrollViewer" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto" PanningMode="Both" Cursor="SizeAll" PreviewMouseLeftButtonDown="OnImageMouseLeftButtonDown" PreviewMouseLeftButtonUp="OnImageMouseLeftButtonUp" PreviewMouseMove="OnImageMouseMove" PreviewMouseWheel="OnScreenshotMouseWheel">
                                <ItemsControl ItemsSource="{Binding Screenshots}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border BorderBrush="#333" BorderThickness="1" Margin="20">
                                                <Image Source="{Binding}" Width="{Binding DataContext.ScreenshotZoom, RelativeSource={RelativeSource AncestorType=Window}}" Stretch="Uniform"/>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Grid>
                    </TabItem>

                    <TabItem Header="CONFIG">
                        <TextBox Text="{Binding PressConfig}" IsReadOnly="True" FontFamily="{DynamicResource ContentFontFamily}" Background="{DynamicResource BgDark}" Foreground="{DynamicResource TextPrimary}" BorderThickness="0" VerticalScrollBarVisibility="Auto" Padding="10"/>
                    </TabItem>

                    <TabItem Header="DB &amp; CONFIG">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <Border Grid.Row="0" Background="{DynamicResource BgPanel}" Padding="10" Margin="0,0,0,5" CornerRadius="4">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Select File:" VerticalAlignment="Center" Foreground="{DynamicResource TextSecondary}" Margin="0,0,10,0" FontWeight="Normal"/>
                                    <ComboBox ItemsSource="{Binding ConfigurationFiles}" SelectedItem="{Binding SelectedConfigFile, Mode=TwoWay}" Width="350" Height="30" VerticalContentAlignment="Center" Background="{DynamicResource BgDark}" Foreground="{DynamicResource TextPrimary}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" Padding="5,0">
                                        <ComboBox.Template>
                                            <ControlTemplate TargetType="ComboBox">
                                                <Grid>
                                                    <ToggleButton Name="ToggleButton" Grid.Column="2" Focusable="false" IsChecked="{Binding Path=IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}" ClickMode="Press" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}">
                                                        <ToggleButton.Template>
                                                            <ControlTemplate TargetType="ToggleButton">
                                                                <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="4">
                                                                    <Grid>
                                                                        <Grid.ColumnDefinitions>
                                                                            <ColumnDefinition Width="*"/>
                                                                            <ColumnDefinition Width="20"/>
                                                                        </Grid.ColumnDefinitions>
                                                                        <ContentPresenter Grid.Column="0" Content="{TemplateBinding Content}" Margin="5,0"/>
                                                                        <Path Grid.Column="1" Data="M 0 0 L 4 4 L 8 0 Z" Fill="{DynamicResource TextSecondary}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                                    </Grid>
                                                                </Border>
                                                            </ControlTemplate>
                                                        </ToggleButton.Template>
                                                    </ToggleButton>
                                                    <ContentPresenter Name="ContentSite" IsHitTestVisible="False" Content="{TemplateBinding SelectionBoxItem}" ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}" ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}" Margin="5,0,25,0" VerticalAlignment="Center" HorizontalAlignment="Left"/>
                                                    <Popup Name="Popup" Placement="Bottom" IsOpen="{TemplateBinding IsDropDownOpen}" AllowsTransparency="True" Focusable="False" PopupAnimation="Slide">
                                                        <Border Name="DropDownBorder" Background="{DynamicResource BgDark}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" CornerRadius="4" MinWidth="{TemplateBinding ActualWidth}" MaxHeight="200">
                                                            <Border.Effect>
                                                                <DropShadowEffect Color="Black" Opacity="0.3" BlurRadius="10" ShadowDepth="2"/>
                                                            </Border.Effect>
                                                            <ScrollViewer Margin="0" SnapsToDevicePixels="True">
                                                                <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained"/>
                                                            </ScrollViewer>
                                                        </Border>
                                                    </Popup>
                                                </Grid>
                                            </ControlTemplate>
                                        </ComboBox.Template>
                                        <ComboBox.ItemContainerStyle>
                                            <Style TargetType="ComboBoxItem">
                                                <Setter Property="Foreground" Value="{DynamicResource TextPrimary}"/>
                                                <Setter Property="Background" Value="Transparent"/>
                                                <Setter Property="Padding" Value="8,6"/>
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="ComboBoxItem">
                                                            <Border Name="Border" Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}">
                                                                <ContentPresenter/>
                                                            </Border>
                                                            <ControlTemplate.Triggers>
                                                                <Trigger Property="IsHighlighted" Value="True">
                                                                    <Setter TargetName="Border" Property="Background" Value="{DynamicResource PrimaryColor}"/>
                                                                    <Setter Property="Foreground" Value="White"/>
                                                                </Trigger>
                                                                <Trigger Property="IsSelected" Value="True">
                                                                    <Setter TargetName="Border" Property="Background" Value="{DynamicResource PrimaryColor}"/>
                                                                    <Setter Property="Foreground" Value="White"/>
                                                                </Trigger>
                                                            </ControlTemplate.Triggers>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </ComboBox.ItemContainerStyle>
                                    </ComboBox>
                                </StackPanel>
                            </Border>
                            <Border Grid.Row="1" Background="{DynamicResource BgPanel}" Padding="10" Margin="0,0,0,5" CornerRadius="4">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Search:" VerticalAlignment="Center" Foreground="{DynamicResource TextSecondary}" Margin="0,0,10,0" FontWeight="Normal"/>
                                    <TextBox Text="{Binding ConfigSearchText, UpdateSourceTrigger=PropertyChanged}" Width="350" Height="28" VerticalContentAlignment="Center" Background="{DynamicResource BgDark}" Foreground="{DynamicResource TextPrimary}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" Padding="5,0" FontFamily="Consolas, Courier New" FontSize="12"/>
                                </StackPanel>
                            </Border>
                            <Grid Grid.Row="2">
                                <Grid Visibility="{Binding IsDbFileSelected, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <Border Grid.Row="0" Background="{DynamicResource BgPanel}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="0,0,0,1">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="350"/>
                                                <ColumnDefinition Width="100"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="Name" Foreground="{DynamicResource TextSecondary}" FontWeight="SemiBold" Padding="25,8,5,8" FontFamily="Segoe UI" FontSize="12"/>
                                            <TextBlock Grid.Column="1" Text="Type" Foreground="{DynamicResource TextSecondary}" FontWeight="SemiBold" Padding="5,8" FontFamily="Segoe UI" FontSize="12"/>
                                            <TextBlock Grid.Column="2" Text="Schema" Foreground="{DynamicResource TextSecondary}" FontWeight="SemiBold" Padding="5,8" FontFamily="Segoe UI" FontSize="12"/>
                                        </Grid>
                                    </Border>
                                    <TreeView Grid.Row="1" ItemsSource="{Binding DbTreeNodes}" Background="{DynamicResource BgDark}" BorderThickness="0" Padding="0" VirtualizingPanel.IsVirtualizing="False" ScrollViewer.CanContentScroll="False">
                                        <TreeView.Resources>
                                            <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="Transparent"/>
                                            <SolidColorBrush x:Key="{x:Static SystemColors.InactiveSelectionHighlightBrushKey}" Color="Transparent"/>
                                            <SolidColorBrush x:Key="{x:Static SystemColors.HighlightTextBrushKey}" Color="{Binding Color, Source={StaticResource TextPrimary}}"/>
                                            <SolidColorBrush x:Key="{x:Static SystemColors.ControlTextBrushKey}" Color="{Binding Color, Source={StaticResource TextPrimary}}"/>
                                        </TreeView.Resources>
                                        <TreeView.ItemContainerStyle>
                                            <Style TargetType="TreeViewItem">
                                                <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}"/>
                                                <Setter Property="Visibility" Value="{Binding IsVisible, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                                <Setter Property="Foreground" Value="{DynamicResource TextPrimary}"/>
                                                <Setter Property="Background" Value="Transparent"/>
                                                <Setter Property="BorderThickness" Value="0"/>
                                                <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
                                            </Style>
                                        </TreeView.ItemContainerStyle>
                                        <TreeView.ItemTemplate>
                                            <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                                                <Grid Width="800">
                                                    <Grid.ContextMenu>
                                                        <ContextMenu>
                                                            <MenuItem Header="📊 Browse Table Data" Command="{Binding DataContext.BrowseTableCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding}">
                                                                <MenuItem.Style>
                                                                    <Style TargetType="MenuItem">
                                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding NodeType}" Value="Table">
                                                                                <Setter Property="Visibility" Value="Visible"/>
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </MenuItem.Style>
                                                            </MenuItem>
                                                            <MenuItem Header="📋 Copy Table Name" Command="{Binding DataContext.CopyTableNameCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding}">
                                                                <MenuItem.Style>
                                                                    <Style TargetType="MenuItem">
                                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding NodeType}" Value="Table">
                                                                                <Setter Property="Visibility" Value="Visible"/>
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </MenuItem.Style>
                                                            </MenuItem>
                                                            <MenuItem Header="📋 Copy Column Name" Command="{Binding DataContext.CopyTableNameCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding}">
                                                                <MenuItem.Style>
                                                                    <Style TargetType="MenuItem">
                                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding NodeType}" Value="Column">
                                                                                <Setter Property="Visibility" Value="Visible"/>
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </MenuItem.Style>
                                                            </MenuItem>
                                                        </ContextMenu>
                                                    </Grid.ContextMenu>
                                                    <Grid.InputBindings>
                                                        <MouseBinding MouseAction="LeftDoubleClick" Command="{Binding DataContext.BrowseTableCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding}"/>
                                                    </Grid.InputBindings>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="330"/>
                                                        <ColumnDefinition Width="100"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Grid.Column="0" Text="{Binding Name}" Foreground="{DynamicResource TextPrimary}" FontFamily="Segoe UI" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="1" Text="{Binding Type}" Foreground="#64B5F6" FontFamily="Consolas" FontSize="10" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="2" Text="{Binding Schema}" Foreground="{DynamicResource TextSecondary}" FontFamily="Consolas" FontSize="10" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                                                </Grid>
                                            </HierarchicalDataTemplate>
                                        </TreeView.ItemTemplate>
                                    </TreeView>
                                </Grid>
                                <TextBox Text="{Binding ConfigFileContent}" IsReadOnly="True" FontFamily="Consolas, Courier New" FontSize="12" FontWeight="Normal" Background="{DynamicResource BgDark}" Foreground="{DynamicResource TextPrimary}" BorderThickness="0" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto" AcceptsReturn="True" Padding="10" Visibility="{Binding IsDbFileSelected, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>
                            </Grid>
                        </Grid>
                    </TabItem>

                    <TabItem Header="SETUP INFO">
                        <TextBox Text="{Binding SetupInfo}" IsReadOnly="True" FontFamily="{DynamicResource ContentFontFamily}" Background="{DynamicResource BgDark}" Foreground="{DynamicResource TextPrimary}" BorderThickness="0" VerticalScrollBarVisibility="Auto" Padding="10"/>
                    </TabItem>
                </TabControl>

                <GridSplitter Grid.Row="2" Height="5" HorizontalAlignment="Stretch" VerticalAlignment="Center" Background="#444" ShowsPreview="True">
                    <GridSplitter.Style>
                        <Style TargetType="GridSplitter">
                            <Setter Property="Visibility" Value="Collapsed"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding SelectedIndex, ElementName=MainTabs}" Value="2">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </GridSplitter.Style>
                </GridSplitter>

                <!-- APP Selected Log Details Panel - REMOVED (use double-click to open Log Details Window instead) -->

                <Border Grid.Row="4" Background="{DynamicResource BgPanel}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="0,1,0,0" Padding="15,8">
                    <Grid>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Button Content="🔍 Edit Filters..." Command="{Binding OpenFilterWindowCommand}" Style="{DynamicResource ModernBtn}" Background="{DynamicResource BgCard}"/>
                            <Button Content="🎨 Color Rules..." Command="{Binding OpenColoringWindowCommand}" Style="{DynamicResource ModernBtn}" Background="{DynamicResource BgCard}"/>
                            <Button Content="⏱" Command="{Binding OpenTimeRangeFilterCommand}" Style="{DynamicResource ModernBtn}" Background="{DynamicResource BgCard}" ToolTip="Filter by Time Range" FontSize="16" Padding="8,4" Margin="5,0,0,0"/>
                            <Rectangle Width="1" Fill="{DynamicResource BorderColor}" Margin="10,4"/>
                            <CheckBox Content="APPLY FILTER OUT" IsChecked="{Binding IsFilterOutActive}" ToolTip="Uncheck to reveal hidden logs" VerticalAlignment="Center" Margin="10,0,15,0" Foreground="{DynamicResource TextPrimary}" FontWeight="SemiBold"/>
                            <CheckBox Content="APPLY FILTER" IsChecked="{Binding IsFilterActive}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}" FontWeight="SemiBold"/>
                            <Rectangle Width="1" Fill="{DynamicResource BorderColor}" Margin="10,4"/>

                            <Button Command="{Binding FilterAppErrorsCommand}" Background="{DynamicResource DangerColor}" Foreground="White" Margin="10,0,0,0" ToolTip="Show Errors Only (Newest First)">
                                <Button.Style>
                                    <Style TargetType="Button" BasedOn="{StaticResource ModernBtn}">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SelectedIndex, ElementName=MainTabs}" Value="2">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="🐞" Margin="0,0,6,0"/>
                                    <TextBlock Text="SHOW ERRORS ONLY" FontWeight="Bold"/>
                                </StackPanel>
                            </Button>

                            <Border Background="{DynamicResource BgCard}" CornerRadius="8" Padding="4" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" Visibility="{Binding IsPLCTabSelected, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <StackPanel Orientation="Horizontal">
                                    <RadioButton GroupName="ViewMode" Content="TEXT" IsChecked="{Binding IsVisualMode, Converter={StaticResource InverseBooleanConverter}}" Style="{StaticResource ViewModeRadioButton}"/>
                                    <RadioButton GroupName="ViewMode" Content="VISUAL" IsChecked="{Binding IsVisualMode}" Style="{StaticResource ViewModeRadioButton}" Margin="4,0,0,0"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>

            <!-- Left panel show button (appears at left edge when panel is hidden) -->
            <Border Grid.Column="2" Width="8" HorizontalAlignment="Left" VerticalAlignment="Stretch"
                    Background="Transparent" Cursor="Hand"
                    Visibility="{Binding IsLeftPanelVisible, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                    MouseLeftButtonDown="LeftPanelShowButton_Click"
                    MouseEnter="PanelShowButton_MouseEnter"
                    MouseLeave="PanelShowButton_MouseLeave"
                    x:Name="LeftPanelShowButton">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Background" Value="Transparent"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{DynamicResource PrimaryColor}"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <TextBlock Text="▶" FontSize="8" FontWeight="Bold" VerticalAlignment="Center" HorizontalAlignment="Center"
                           Foreground="White" Opacity="0" x:Name="LeftPanelShowArrow">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsMouseOver, ElementName=LeftPanelShowButton}" Value="True">
                                    <Setter Property="Opacity" Value="1"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
            </Border>

            <!-- Right panel show button (appears at right edge when panel is hidden) -->
            <Border Grid.Column="2" Width="8" HorizontalAlignment="Right" VerticalAlignment="Stretch"
                    Background="Transparent" Cursor="Hand"
                    Visibility="{Binding IsRightPanelVisible, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                    MouseLeftButtonDown="RightPanelShowButton_Click"
                    MouseEnter="PanelShowButton_MouseEnter"
                    MouseLeave="PanelShowButton_MouseLeave"
                    x:Name="RightPanelShowButton">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Background" Value="Transparent"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{DynamicResource PrimaryColor}"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <TextBlock Text="◀" FontSize="8" FontWeight="Bold" VerticalAlignment="Center" HorizontalAlignment="Center"
                           Foreground="White" Opacity="0" x:Name="RightPanelShowArrow">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsMouseOver, ElementName=RightPanelShowButton}" Value="True">
                                    <Setter Property="Opacity" Value="1"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
            </Border>

            <GridSplitter Grid.Column="3" Width="4" HorizontalAlignment="Center" VerticalAlignment="Stretch" Background="Transparent" ShowsPreview="True"
                          Visibility="{Binding IsRightPanelVisible, Converter={StaticResource BoolToVisibilityConverter}}"/>

            <!-- Right Panel with hover toggle button -->
            <Grid Grid.Column="4" Visibility="{Binding IsRightPanelVisible, Converter={StaticResource BoolToVisibilityConverter}}">
            <Border Background="{DynamicResource BgPanel}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1,0,0,0" Padding="15">
                <DockPanel>
                    <TextBlock Text="SAVED CONFIGURATIONS" Foreground="{DynamicResource TextSecondary}" FontWeight="Bold" FontSize="11" Margin="0,0,0,15" DockPanel.Dock="Top"/>
                    <Grid DockPanel.Dock="Bottom" VerticalAlignment="Bottom" Margin="0,15,0,0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Border Grid.Row="0" Background="{DynamicResource BgCard}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" CornerRadius="8" Padding="10" Margin="0,0,0,10" Visibility="{Binding IsConfigMenuOpen, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <Border.Effect>
                                <DropShadowEffect Color="Black" Opacity="0.2" BlurRadius="10" ShadowDepth="2"/>
                            </Border.Effect>
                            <StackPanel>
                                <DockPanel LastChildFill="False" Margin="0,0,0,8">
                                    <TextBlock Text="Actions" FontWeight="Bold" Foreground="{DynamicResource TextSecondary}" VerticalAlignment="Center" FontSize="11"/>
                                </DockPanel>
                                <Button Command="{Binding SaveConfigCommand}" Style="{DynamicResource ModernBtn}" Background="{DynamicResource SuccessColor}" Foreground="White" Margin="0,0,0,5">
                                    <Viewbox Stretch="Uniform" StretchDirection="DownOnly">
                                        <TextBlock Text="💾 Save Current"/>
                                    </Viewbox>
                                </Button>
                                <Button Command="{Binding LoadConfigCommand}" Style="{DynamicResource ModernBtn}" Background="{DynamicResource BgCard}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,5">
                                    <Viewbox Stretch="Uniform" StretchDirection="DownOnly">
                                        <TextBlock Text="📂 Load Selected"/>
                                    </Viewbox>
                                </Button>
                                <Button Command="{Binding RemoveConfigCommand}" Style="{DynamicResource ModernBtn}" Background="Transparent" BorderBrush="{DynamicResource DangerColor}" Foreground="{DynamicResource DangerColor}" BorderThickness="1">
                                    <Viewbox Stretch="Uniform" StretchDirection="DownOnly">
                                        <TextBlock Text="🗑 Delete Selected"/>
                                    </Viewbox>
                                </Button>
                            </StackPanel>
                        </Border>
                        <Button Grid.Row="1" Command="{Binding ToggleConfigMenuCommand}" Background="{DynamicResource BgCard}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" HorizontalAlignment="Left" Width="40" Height="40" ToolTip="Show Actions">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border x:Name="border" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="20">
                                        <Border.Effect>
                                            <DropShadowEffect Color="Black" Opacity="0.15" BlurRadius="5" ShadowDepth="2"/>
                                        </Border.Effect>
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="{DynamicResource BgCardHover}"/>
                                            <Setter TargetName="border" Property="BorderBrush" Value="{DynamicResource PrimaryColor}"/>
                                        </Trigger>
                                        <Trigger Property="IsPressed" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="{DynamicResource PrimaryColor}"/>
                                            <Setter Property="Foreground" Value="White"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                            <Grid>
                                <TextBlock Text="••" FontSize="20" FontWeight="Bold" Foreground="{DynamicResource TextPrimary}" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,-8,0,0">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Visibility" Value="Visible"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsConfigMenuOpen}" Value="True">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                                <TextBlock Text="✕" FontSize="14" FontWeight="Bold" Foreground="{DynamicResource TextPrimary}" HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsConfigMenuOpen}" Value="True">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </Grid>
                        </Button>
                    </Grid>
                    <ListView ItemsSource="{Binding SavedConfigs}" SelectedItem="{Binding SelectedConfig, Mode=TwoWay}" Background="Transparent" BorderThickness="0" Foreground="{DynamicResource TextPrimary}" HorizontalContentAlignment="Stretch">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,4" Background="Transparent">
                                    <Grid.InputBindings>
                                        <MouseBinding Gesture="LeftDoubleClick" Command="{Binding DataContext.ApplyConfigCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding}"/>
                                    </Grid.InputBindings>
                                    <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                        <ListView.ItemContainerStyle>
                            <Style TargetType="ListViewItem">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="ListViewItem">
                                            <Border Name="Border" Padding="8" CornerRadius="4" Background="Transparent">
                                                <ContentPresenter/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsSelected" Value="True">
                                                    <Setter TargetName="Border" Property="Background" Value="{DynamicResource PrimaryGlow}"/>
                                                    <Setter TargetName="Border" Property="BorderBrush" Value="{DynamicResource PrimaryColor}"/>
                                                    <Setter TargetName="Border" Property="BorderThickness" Value="1"/>
                                                </Trigger>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="Border" Property="Background" Value="#15888888"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </ListView.ItemContainerStyle>
                    </ListView>
                </DockPanel>
            </Border>
                <!-- Right panel hide button (appears on hover at left edge of right panel) -->
                <Border x:Name="RightPanelHideButton" Width="16" HorizontalAlignment="Left" VerticalAlignment="Stretch"
                        Background="Transparent" Cursor="Hand" Opacity="0"
                        MouseLeftButtonDown="RightPanelHideButton_Click">
                    <Border.Style>
                        <Style TargetType="Border">
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource BgCardHover}"/>
                                    <Setter Property="Opacity" Value="1"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>
                    <TextBlock Text="▶" FontSize="10" FontWeight="Bold" VerticalAlignment="Center" HorizontalAlignment="Center"
                               Foreground="{DynamicResource TextSecondary}"/>
                </Border>
            </Grid>

        </Grid>

        <controls:StatusBarControl Grid.Row="2" DataContext="{Binding}"/>

        <Grid Grid.RowSpan="3" Background="#CC000000" Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}, FallbackValue=Collapsed}" Panel.ZIndex="999">
            <Border Background="{DynamicResource BgPanel}" BorderBrush="{DynamicResource PrimaryColor}" BorderThickness="0" CornerRadius="30" HorizontalAlignment="Center" VerticalAlignment="Center" Width="450" Height="300">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="80" ShadowDepth="0" Opacity="0.9" Color="{Binding Color, Source={StaticResource PrimaryColor}}"/>
                </Border.Effect>
                <Grid Margin="30">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="140"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <Grid Grid.Row="0" Width="140" Height="140" VerticalAlignment="Top" HorizontalAlignment="Center">
                        <Ellipse StrokeThickness="6" Width="120" Height="120" VerticalAlignment="Center" HorizontalAlignment="Center">
                            <Ellipse.Effect>
                                <DropShadowEffect Color="{Binding Color, Source={StaticResource AnimColor1}}" BlurRadius="25" ShadowDepth="0" Opacity="1"/>
                            </Ellipse.Effect>
                            <Ellipse.Stroke>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="{Binding Color, Source={StaticResource AnimColor1}}" Offset="0"/>
                                    <GradientStop Color="Transparent" Offset="0.8"/>
                                </LinearGradientBrush>
                            </Ellipse.Stroke>
                            <Ellipse.RenderTransform>
                                <RotateTransform Angle="0" CenterX="60" CenterY="60"/>
                            </Ellipse.RenderTransform>
                            <Ellipse.Triggers>
                                <EventTrigger RoutedEvent="Loaded">
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)" From="0" To="360" Duration="0:0:1.5" RepeatBehavior="Forever"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                            </Ellipse.Triggers>
                        </Ellipse>
                        <Ellipse StrokeThickness="4" Width="90" Height="90" VerticalAlignment="Center" HorizontalAlignment="Center">
                            <Ellipse.Effect>
                                <DropShadowEffect Color="{Binding Color, Source={StaticResource AnimColor2}}" BlurRadius="20" ShadowDepth="0" Opacity="1"/>
                            </Ellipse.Effect>
                            <Ellipse.Stroke>
                                <LinearGradientBrush StartPoint="1,0" EndPoint="0,1">
                                    <GradientStop Color="{Binding Color, Source={StaticResource AnimColor2}}" Offset="0"/>
                                    <GradientStop Color="Transparent" Offset="0.8"/>
                                </LinearGradientBrush>
                            </Ellipse.Stroke>
                            <Ellipse.RenderTransform>
                                <RotateTransform Angle="360" CenterX="45" CenterY="45"/>
                            </Ellipse.RenderTransform>
                            <Ellipse.Triggers>
                                <EventTrigger RoutedEvent="Loaded">
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)" From="360" To="0" Duration="0:0:2" RepeatBehavior="Forever"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                            </Ellipse.Triggers>
                        </Ellipse>
                        <Ellipse Width="60" Height="60" VerticalAlignment="Center" HorizontalAlignment="Center">
                            <Ellipse.Fill>
                                <RadialGradientBrush>
                                    <GradientStop Color="{Binding Color, Source={StaticResource AnimColor3}}" Offset="0"/>
                                    <GradientStop Color="Transparent" Offset="1"/>
                                </RadialGradientBrush>
                            </Ellipse.Fill>
                            <Ellipse.Effect>
                                <DropShadowEffect Color="{Binding Color, Source={StaticResource AnimColor3}}" BlurRadius="30" ShadowDepth="0" Opacity="0.8"/>
                            </Ellipse.Effect>
                            <Ellipse.RenderTransform>
                                <ScaleTransform ScaleX="1" ScaleY="1" CenterX="30" CenterY="30"/>
                            </Ellipse.RenderTransform>
                            <Ellipse.Triggers>
                                <EventTrigger RoutedEvent="Loaded">
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)" From="0.7" To="1.2" Duration="0:0:1.2" RepeatBehavior="Forever" AutoReverse="True"/>
                                            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)" From="0.7" To="1.2" Duration="0:0:1.2" RepeatBehavior="Forever" AutoReverse="True"/>
                                            <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0.3" To="0.8" Duration="0:0:1.2" RepeatBehavior="Forever" AutoReverse="True"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                            </Ellipse.Triggers>
                        </Ellipse>
                        <TextBlock Text="{Binding CurrentProgress, StringFormat='{}{0:0}%'}" FontSize="24" FontWeight="Bold" Foreground="{DynamicResource AnimText}" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock.Effect>
                                <DropShadowEffect Color="{Binding Color, Source={StaticResource AnimText}}" BlurRadius="15" ShadowDepth="0" Opacity="0.7"/>
                            </TextBlock.Effect>
                        </TextBlock>
                    </Grid>
                    <TextBlock Grid.Row="1" Text="{Binding StatusMessage}" FontSize="16" Foreground="{DynamicResource TextPrimary}" HorizontalAlignment="Center" VerticalAlignment="Top" TextAlignment="Center" TextWrapping="Wrap" Margin="0,10,0,0" MaxHeight="80"/>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Window>   